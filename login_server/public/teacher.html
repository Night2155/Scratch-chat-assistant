<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ•™å¸«å­¸ç¿’æ­·ç¨‹åˆ†æå¾Œå°</title>
  <link rel="stylesheet" href="css/teacher.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="navbar">
    <div class="navbar-left">
      <img src="images/login.png" alt="Logo" class="logo-img" />
      <span class="title">å­¸ç”Ÿå­¸ç¿’æ­·ç¨‹åˆ†æ</span>
    </div>
    <div class="nav-tabs">
      <span class="tab active">ä»»å‹™åˆ†æå„€è¡¨æ¿</span>
    </div>
    <div class="navbar-right">
      <span class="teacher-name" id="teacherName">è¼‰å…¥ä¸­...</span>
    </div>
  </div>

  <div class="main-content">
    <div class="teacher-container">
      <div class="student-list-container"> 
        <div class="list-filter">
          <select id="classFilter" class="class-select">
            <option value="all">å…¨éƒ¨ç­ç´š</option>
            <option value="3A">3A ç­</option>
            <option value="3B">3B ç­</option>
            <option value="3C">3C ç­</option>
          </select>
      </div>

  <div class="student-list" id="studentList">
    </div>

</div>

      <div class="analysis-panel" id="analysisPanel">
        <div class="panel-header">
          <h2 id="currentStudentName">è«‹é¸æ“‡å­¸ç”Ÿ</h2>
          <select id="projectSelect" class="project-select">
            <option value="mission1">ä»»å‹™ä¸€ï¼šè§’è‰²ç§»å‹•</option>
            <option value="mission2">ä»»å‹™äºŒï¼šè¿·å®®éŠæˆ²</option>
          </select>
        </div>

        <div class="charts-container">
          <div class="chart-card">
            <h3>ğŸ“ˆ ç¨‹å¼ç¢¼æ¼”åŒ–æ­·ç¨‹</h3>
            <div class="chart-wrapper">
              <canvas id="evolutionChart"></canvas>
            </div>
          </div>
          
          <div class="chart-card">
            <h3>wwl ç©æœ¨èƒ½åŠ›é›·é”</h3>
            <div class="chart-wrapper">
              <canvas id="radarChart"></canvas>
            </div>
          </div>
        </div>

        <div class="info-container">
          <div class="ai-summary-card">
            <h3>ğŸ¤– AI å­¸ç¿’è¨ºæ–·</h3>
            <div class="ai-content" id="aiSummaryContent">
              <p class="placeholder-text">é»æ“Šå­¸ç”Ÿä»¥æŸ¥çœ‹ AI åˆ†æçµæœ...</p>
            </div>
          </div>

          <div class="chat-log-card">
            <h3>ğŸ’¬ é—œéµæ€è€ƒèˆ‡å°è©±ç´€éŒ„</h3>
            <div class="log-list" id="logList">
              </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // åˆå§‹åŒ–ä½¿ç”¨è€…åç¨±
    const urlParams = new URLSearchParams(window.location.search);
    document.getElementById("teacherName").textContent = (urlParams.get("name") || "è€å¸«") + " è€å¸«";

    // å…¨åŸŸåœ–è¡¨è®Šæ•¸ (åˆ‡æ›å­¸ç”Ÿæ™‚éœ€è¦éŠ·æ¯€é‡å»º)
    let evolutionChartInstance = null;
    let radarChartInstance = null;

    // âœ… æ¨¡æ“¬è¼‰å…¥å­¸ç”Ÿè³‡æ–™ (é€™æ˜¯é››å½¢ï¼Œä¹‹å¾Œæœƒæ¥ Firebase)
    function loadStudentData(studentName) {
      document.getElementById("currentStudentName").textContent = `æ­£åœ¨åˆ†æï¼š${studentName}`;
      
      // 1. ç¹ªè£½æŠ˜ç·šåœ– (æ¨¡æ“¬è³‡æ–™)
      renderEvolutionChart([5, 8, 12, 15, 10, 2, 18, 25, 30]); 
      
      // 2. ç¹ªè£½é›·é”åœ– (æ¨¡æ“¬è³‡æ–™)
      renderRadarChart([80, 40, 60, 20, 90]);

      // 3. å¡«å…¥ AI ç¸½çµ (æ¨¡æ“¬)
      document.getElementById("aiSummaryContent").innerHTML = `
        <p><strong>è¡¨ç¾äº®é»ï¼š</strong>${studentName} åœ¨ã€Œå‹•ä½œã€èˆ‡ã€Œäº‹ä»¶ã€ç©æœ¨çš„ä½¿ç”¨ä¸Šéå¸¸ç†Ÿç·´ã€‚</p>
        <p><strong>æ½›åœ¨ç“¶é ¸ï¼š</strong>åœ¨ä¸­æ®µï¼ˆç´„ç¬¬ 15 åˆ†é˜ï¼‰æ›¾å¤§å¹…åˆªé™¤ç¨‹å¼ç¢¼ï¼Œé¡¯ç¤ºå¯èƒ½åœ¨ã€Œè¿´åœˆæ§åˆ¶ã€é‚è¼¯ä¸Šé‡åˆ°æŒ«æŠ˜ã€‚</p>
        <p><strong>å»ºè­°ï¼š</strong>å»ºè­°è€å¸«å¯ä»¥å¼•å°ä»–è§€å¯Ÿã€Œé‡è¤‡ç„¡é™æ¬¡ã€èˆ‡ã€Œæ¢ä»¶åˆ¤æ–·ã€çš„å·®ç•°ã€‚</p>
      `;

      // 4. å¡«å…¥å°è©±ç´€éŒ„ (æ¨¡æ“¬)
      const logs = [
        { time: "10:05", type: "run", text: "é»æ“Šç¶ æ——åŸ·è¡Œå°ˆæ¡ˆ" },
        { time: "10:08", type: "ai", text: "å­¸ç”Ÿå•ï¼šè²“å’ªç‚ºä»€éº¼ä¸æœƒåœä¸‹ä¾†ï¼Ÿ", ai: "AI å›ç­”ï¼šè©¦è©¦çœ‹æª¢æŸ¥ä½ çš„ã€Œé‡è¤‡ç„¡é™æ¬¡ã€ç©æœ¨è£¡é¢æœ‰æ²’æœ‰æ”¾ã€Œåœæ­¢ã€çš„æŒ‡ä»¤å–”ï¼" },
        { time: "10:15", type: "delete", text: "åˆªé™¤äº† 8 å€‹ç©æœ¨ (å¤§å¹…ä¿®æ”¹)" },
        { time: "10:20", type: "run", text: "åŸ·è¡Œå°ˆæ¡ˆ (æˆåŠŸ)" }
      ];
      renderLogs(logs);
    }

    // ç¹ªè£½æŠ˜ç·šåœ–å‡½å¼
    function renderEvolutionChart(dataPoints) {
      const ctx = document.getElementById('evolutionChart').getContext('2d');
      if (evolutionChartInstance) evolutionChartInstance.destroy();

      evolutionChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['0m', '5m', '10m', '15m', '20m', '25m', '30m', '35m', '40m'],
          datasets: [{
            label: 'ç©æœ¨ç¸½æ•¸',
            data: dataPoints,
            borderColor: '#6d00ff',
            backgroundColor: 'rgba(109, 0, 255, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: { responsive: true, maintainAspectRatio: false }
      });
    }

    // ç¹ªè£½é›·é”åœ–å‡½å¼
    function renderRadarChart(dataPoints) {
      const ctx = document.getElementById('radarChart').getContext('2d');
      if (radarChartInstance) radarChartInstance.destroy();

      radarChartInstance = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: ['å‹•ä½œ', 'å¤–è§€', 'äº‹ä»¶', 'æ§åˆ¶', 'é‹ç®—'],
          datasets: [{
            label: 'ç©æœ¨ä½¿ç”¨åˆ†ä½ˆ',
            data: dataPoints,
            backgroundColor: 'rgba(255, 159, 64, 0.2)',
            borderColor: 'rgba(255, 159, 64, 1)',
            pointBackgroundColor: 'rgba(255, 159, 64, 1)',
          }]
        },
        options: { responsive: true, maintainAspectRatio: false }
      });
    }

    // æ¸²æŸ“ Log åˆ—è¡¨
    function renderLogs(logs) {
      const list = document.getElementById("logList");
      list.innerHTML = "";
      logs.forEach(log => {
        let icon = "ğŸ”¹";
        let styleClass = "log-item";
        if (log.type === "ai") { icon = "ğŸ¤–"; styleClass += " ai-log"; }
        if (log.type === "delete") { icon = "âš ï¸"; styleClass += " delete-log"; }
        
        let content = `<span class="log-time">${log.time}</span> <span class="log-text">${icon} ${log.text}</span>`;
        if(log.ai) content += `<div class="ai-reply">${log.ai}</div>`;
        
        const div = document.createElement("div");
        div.className = styleClass;
        div.innerHTML = content;
        list.appendChild(div);
      });
    }
  </script>
  <script>
    // 1. æ¨¡æ“¬å­¸ç”Ÿè³‡æ–™ (ä¹‹å¾Œé€™è£¡å¯ä»¥å¾ Firebase è®€å–)
    const allStudents = [
      { id: 's1', name: 'student1', class: '3A', progress: 33, avatar: 'images/login.png' },
      { id: 's2', name: 'student2', class: '3A', progress: 66, avatar: 'images/login.png' },
      { id: 's3', name: 'student3', class: '3B', progress: 10, avatar: 'images/login.png' },
      { id: 's4', name: 'student4', class: '3B', progress: 90, avatar: 'images/login.png' },
      { id: 's5', name: 'student5', class: '3C', progress: 0,  avatar: 'images/login.png' },
    ];

    // åˆå§‹åŒ–
    
    const teacherName = urlParams.get("name") || "è€å¸«";
    document.getElementById("teacherName").textContent = teacherName + " è€å¸«æ‚¨å¥½ !";

    const studentListEl = document.getElementById('studentList');
    const classFilterEl = document.getElementById('classFilter');

    // 2. æ¸²æŸ“å­¸ç”Ÿåˆ—è¡¨å‡½å¼
    function renderStudentList(filterClass) {
      studentListEl.innerHTML = ''; // æ¸…ç©ºåˆ—è¡¨

      // éæ¿¾è³‡æ–™
      const filteredStudents = allStudents.filter(student => {
        if (filterClass === 'all') return true; // é¡¯ç¤ºå…¨éƒ¨
        return student.class === filterClass;   // åªé¡¯ç¤ºè©²ç­ç´š
      });

      // å¦‚æœæ²’æœ‰å­¸ç”Ÿ
      if (filteredStudents.length === 0) {
        studentListEl.innerHTML = '<p style="text-align:center; color:#888; margin-top:20px;">æ­¤ç­ç´šç„¡å­¸ç”Ÿè³‡æ–™</p>';
        return;
      }

      // ç”¢ç”Ÿ HTML
      filteredStudents.forEach(student => {
        const div = document.createElement('div');
        div.className = 'student-item';
        // ç¶å®šé»æ“Šäº‹ä»¶ (å‘¼å«åŸæœ¬å®šç¾©å¥½çš„è¼‰å…¥åœ–è¡¨å‡½å¼)
        div.onclick = () => loadStudentData(student.name);

        div.innerHTML = `
          <img src="${student.avatar}" class="student-avatar" alt="avatar" />
          <div class="student-info">
            <div class="student-name">${student.name}</div>
            <div class="student-meta">${student.class} ç­ï½œé€²åº¦ ${student.progress}%</div>
            <div class="progress-bar">
              <div class="progress" style="width: ${student.progress}%;"></div>
            </div>
          </div>
        `;
        studentListEl.appendChild(div);
      });
    }

    // 3. ç¶å®šç¯©é¸äº‹ä»¶
    classFilterEl.addEventListener('change', (e) => {
      renderStudentList(e.target.value);
    });

    // 4. ä¸€é–‹å§‹è¼‰å…¥å…¨éƒ¨
    renderStudentList('all');

  </script>
</body>
</html>